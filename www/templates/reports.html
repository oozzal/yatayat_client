<ion-view title="Posts">
  <ion-nav-buttons side="left">
    <button menu-toggle="left" class="button button-icon icon ion-navicon"></button>
  </ion-nav-buttons>
  <ion-content class="has-header">
    <ion-refresher
      pulling-text="Pull to refresh..."
      on-refresh="refresh()"
    ></ion-refresher>

    <div id="search-box" class="bar bar-header item-input-inset">
      <div class="item-input-wrapper">
        <i class="icon ion-ios7-search placeholder-icon"></i>
        <input type="search" placeholder="Search" ng-model="data.searchQuery">
        <i class="clear-search icon ion-ios7-close-empty" ng-click="clearSearch()"></i>
      </div>
      <button class="button button-clear button-assertive" ng-click="clearSearch()">
        Cancel
      </button>
    </div>

    <ion-list>
      <ion-item ng-repeat="report in reports | filter:search(data.searchQuery)" class="item item-avatar" href="#/app/reports/{{report.id}}">
        <img ng-src="{{ report.image || 'img/default.png' }}">
        <h2 ng-bind="report.category.name"></h2>
        <p class="item-text-wrap" ng-bind="report.message"></p>
        <span ng-show="user.role==='admin' || user.role==='super_admin'">
          <button
            class="button button-small button-outline button-assertive icon ion-trash-a"
            ng-click="deleteReport($index, $event)">
          </button>
        </span>
        <button
          class="button button-small button-outline button-balanced icon icon-left ion-thumbsup"
          ng-click="likeReport($index, $event)"
          ng-bind="report.cached_votes_up">
        </button>
        <button
          class="button button-small button-outline button-assertive icon icon-left ion-thumbsdown"
          ng-click="dislikeReport($index, $event)"
          ng-bind="report.cached_votes_down">
        </button>
        <br />
        <br />
        <p>
          <span class="item-text-wrap">
            <i class="icon ion-location"></i> {{ report.location.name }}
            <br />
            <i class="icon ion-clock"></i> {{ report.created_at | date: 'medium' }}
          </span>
          <br />
          <a ng-href="#/app/user_details/{{report.user_id}}">
            <i class="icon ion-person"></i> {{ report.user.username || 'Anonymous' }}
          </a>
          <button
            class="button button-small button-clear button-balanced icon icon-left ion-thumbsup"
            ng-bind="report.user.cached_votes_up">
          </button>
          <button
            class="button button-small button-clear button-assertive icon icon-left ion-thumbsdown"
            ng-bind="report.user.cached_votes_down">
          </button>
        </p>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-view>

